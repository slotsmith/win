<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Slot Smith Pro - Login</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* --- Common styles --- */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1f1f2e;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #00ffc3;
    }
    button {
      cursor: pointer;
      border-radius: 8px;
      border: none;
      padding: 10px 20px;
      background: #00ffc3;
      color: #1f1f2e;
      font-weight: 600;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #00b38f;
    }
    input, select {
      font-size: 1rem;
      padding: 10px;
      border-radius: 8px;
      border: none;
      outline: none;
      margin-bottom: 15px;
      width: 100%;
      box-sizing: border-box;
    }
    .error-msg {
      color: #ff6666;
      margin-bottom: 10px;
      text-align: center;
    }
    .success-msg {
      color: #00ffb3;
      margin-bottom: 10px;
      text-align: center;
    }
    a {
      color: #00ffc3;
      cursor: pointer;
      text-decoration: underline;
    }
    /* --- Login/Register/Forgot Password Form --- */
    #authContainer {
      max-width: 360px;
      margin: 40px auto;
      background: #2c2c3c;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    #authContainer h2 {
      margin-top: 0;
      margin-bottom: 20px;
    }
    /* --- Dashboard and Admin --- */
    #dashboard, #adminPanel {
      display: none;
      max-width: 1200px;
      margin: 20px auto;
    }
    #dashboard h1 {
      margin-bottom: 5px;
    }
    #lastUpdated {
      text-align: center;
      color: #ccc;
      font-size: 0.9rem;
      margin-bottom: 20px;
    }
    #searchBar {
      display: block;
      margin: 0 auto 30px auto;
      width: 60%;
      max-width: 600px;
      padding: 12px 20px;
      font-size: 1.1rem;
      border-radius: 15px;
      border: none;
      outline: none;
      box-shadow: 0 0 10px #00ffc3;
      background: #2c2c3c;
      color: #fff;
      transition: box-shadow 0.3s ease;
    }
    #searchBar::placeholder {
      color: #66fff0cc;
    }
    #searchBar:focus {
      box-shadow: 0 0 15px #00ffc3;
      background: #39394a;
    }
    .slots-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));
      gap: 30px;
    }
    .slot-card {
      background: #2c2c3c;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      position: relative;
    }
    .slot-card h2 {
      margin: 0 0 20px;
      color: #00d4ff;
      word-break: break-word;
    }
    .stat {
      margin: 8px 0;
      font-size: 1.1rem;
    }
    .graph-canvas {
      margin-top: 20px;
      width: 100% !important;
      max-height: 90px !important;
      height: auto !important;
    }
    .green {
      color: #00ffb3;
      font-weight: 600;
    }
    .yellow {
      color: #ffd966;
      font-weight: 600;
    }
    .red {
      color: #ff6666;
      font-weight: 600;
    }
    /* --- Admin Controls --- */
    #adminPanel {
      background: #2c2c3c;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }
    #adminPanel h2 {
      color: #00d4ff;
      margin-bottom: 15px;
    }
    #adminControls {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    #adminControls input {
      width: 250px;
    }
    .admin-slot-actions {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 8px;
    }
    .admin-slot-actions button {
      background: #ff6666;
      color: white;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: 600;
      transition: background 0.2s ease;
    }
    .admin-slot-actions button:hover {
      background: #cc5252;
    }
    .admin-slot-actions button.edit-btn {
      background: #ffd966;
      color: #1f1f2e;
    }
    .admin-slot-actions button.edit-btn:hover {
      background: #d4b64f;
    }
    /* --- Logout Button --- */
    #logoutBtn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #ff6666;
      color: white;
      border-radius: 50px;
      padding: 10px 20px;
      font-weight: 700;
      font-size: 1rem;
      border: none;
      cursor: pointer;
      box-shadow: 0 0 10px #ff6666aa;
      transition: background 0.3s ease;
      z-index: 999;
    }
    #logoutBtn:hover {
      background: #cc5252;
    }
    /* --- Modal for Edit --- */
    #editModal {
      position: fixed;
      top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #editModalContent {
      background: #2c2c3c;
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 0 20px #00ffc3aa;
    }
    #editModalContent input {
      width: 100%;
      margin-bottom: 20px;
      font-size: 1.2rem;
      padding: 12px;
      border-radius: 12px;
      border: none;
      outline: none;
      color: #000;
    }
    #editModalContent button {
      margin: 0 10px;
      font-size: 1.1rem;
      padding: 12px 20px;
      border-radius: 15px;
    }
    /* Responsive */
    @media (max-width: 600px) {
      #searchBar {
        width: 90%;
      }
      .slots-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <!-- LOGIN/REGISTER/RESET CONTAINER -->
  <div id="authContainer">
    <h2 id="authTitle">Login</h2>
    <div id="authError" class="error-msg"></div>
    <div id="authSuccess" class="success-msg"></div>
    <input type="text" id="usernameInput" placeholder="Username" autocomplete="username" />
    <input type="password" id="passwordInput" placeholder="Password" autocomplete="current-password" />
    <input type="password" id="passwordInput2" placeholder="Confirm Password" style="display:none" autocomplete="new-password"/>
    <input type="email" id="emailInput" placeholder="Email (for password reset)" style="display:none" autocomplete="email" />
    <button id="authBtn">Login</button>
    <p style="text-align:center; margin-top:10px;">
      <span id="toggleLoginRegister" style="cursor:pointer; user-select:none; color:#00ffc3;">Don't have an account? Register</span>
    </p>
    <p style="text-align:center; margin-top:-5px;">
      <span id="forgotPasswordLink" style="cursor:pointer; user-select:none; color:#00ffc3;">Forgot Password?</span>
    </p>
    <p style="text-align:center; margin-top:-5px; display:none;" id="backToLoginLink">
      <span id="backToLogin" style="cursor:pointer; user-select:none; color:#00ffc3;">Back to Login</span>
    </p>
  </div>

  <!-- LOGOUT BUTTON -->
  <button id="logoutBtn" style="display:none;">Logout</button>

  <!-- DASHBOARD -->
  <div id="dashboard">
    <h1>ðŸŽ° Slot Smith Pro</h1>
    <p id="lastUpdated">Last updated: --</p>
    <input type="text" id="searchBar" placeholder="Search for a slot game..." />
    <div class="slots-container" id="slotsContainer"></div>
  </div>

  <!-- ADMIN PANEL -->
  <div id="adminPanel">
    <h2>Admin Panel - Manage Slot Games</h2>
    <div id="adminControls">
      <input type="text" id="newSlotName" placeholder="New Slot Game Name" />
      <button id="addSlotBtn">Add Slot Game</button>
    </div>
    <div class="slots-container" id="adminSlotsContainer"></div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal">
    <div id="editModalContent">
      <h3>Edit Slot Name</h3>
      <input type="text" id="editSlotNameInput" />
      <div>
        <button id="saveEditBtn">Save</button>
        <button id="cancelEditBtn">Cancel</button>
      </div>
    </div>
  </div>

<script>
(() => {
  // --- CONSTANTS ---
  const AUTO_LOGOUT_MINUTES = 5; // Auto logout after 5 min inactivity
  const STORAGE_USERS = 'ssp_users';
  const STORAGE_CURRENT_USER = 'ssp_current_user';
  const STORAGE_SLOTS = 'ssp_slots';

  // --- ELEMENTS ---
  const authContainer = document.getElementById('authContainer');
  const authTitle = document.getElementById('authTitle');
  const authError = document.getElementById('authError');
  const authSuccess = document.getElementById('authSuccess');
  const usernameInput = document.getElementById('usernameInput');
  const passwordInput = document.getElementById('passwordInput');
  const passwordInput2 = document.getElementById('passwordInput2');
  const emailInput = document.getElementById('emailInput');
  const authBtn = document.getElementById('authBtn');
  const toggleLoginRegister = document.getElementById('toggleLoginRegister');
  const forgotPasswordLink = document.getElementById('forgotPasswordLink');
  const backToLoginLink = document.getElementById('backToLoginLink');
  const backToLogin = document.getElementById('backToLogin');

  const logoutBtn = document.getElementById('logoutBtn');

  const dashboard = document.getElementById('dashboard');
  const searchBar = document.getElementById('searchBar');
  const slotsContainer = document.getElementById('slotsContainer');

  const adminPanel = document.getElementById('adminPanel');
  const newSlotName = document.getElementById('newSlotName');
  const addSlotBtn = document.getElementById('addSlotBtn');
  const adminSlotsContainer = document.getElementById('adminSlotsContainer');

  const editModal = document.getElementById('editModal');
  const editSlotNameInput = document.getElementById('editSlotNameInput');
  const saveEditBtn = document.getElementById('saveEditBtn');
  const cancelEditBtn = document.getElementById('cancelEditBtn');

  // --- VARIABLES ---
  let users = JSON.parse(localStorage.getItem(STORAGE_USERS)) || {};
  let currentUser = JSON.parse(localStorage.getItem(STORAGE_CURRENT_USER));
  let slotGames = JSON.parse(localStorage.getItem(STORAGE_SLOTS)) || [
    "Sweet Bonanza", "Gates of Olympus", "Starlight Princess", "Sugar Rush", "Big Bass Splash",
    "Wild West Gold", "The Dog House", "Power of Thor Megaways", "Jokerâ€™s Jewels", "Floating Dragon",
    "Madame Destiny Megaways", "John Hunter series", "Chilli Heat", "Buffalo King Megaways", "Mustang Gold",
    "5 Lions series", "Aztec Gems", "Pyramid Bonanza", "Lucky Lightning", "Irish Crown",
    "Gates of Olympus Super Scatter", "Mahjong Wins Super Scatter", "Wild West Gold Blazing Bounty",
    "Gates of Hades", "The Dog House â€“ Royal Hunt", "Book of Monsters", "Big Bass Bonanza 1000",
    "Starlight Princess 1000", "Gates of Olympus 1000", "Sugar Rush 1000", "Sweet Bonanza 1000",
    "Wisdom of Athena 1000", "Gates of Olympus Xmas 1000", "Hades Inferno 1000", "Lucky Tiger 1000",
    "Zeus vs Hades Gods of War", "Gates of Gatotkacha 1000", "Gates of Olympus X-Max 1000",
    "Gates of Gatotkacha", "Candy Blitz Bombs", "Fire Portals", "Sugar Rush X-Max", "Candy Blitz",
    "Rujak Bonanza", "Wildies", "Sweet Bonanza X-Max", "Happy Fortune", "Wisdom of Athena", "Sticky Bees",
    "Cyan Mania", "Forge of Olympus", "Wild Bison Church", "The Dog House Dog or Alive",
    "Mustang Gold Mega Waste", "Will of Gold", "Gates of Olympus Dice", "Aztec Treasure Hunt",
    "Angel vs Sinner", "Power of Ninja", "Six Joker", "Twilight Princess", "Cyber Heist",
    "Five Lions Mega Waste", "Big Bus Bay at the Graces", "Heart of Cleopatra", "The Dog House Mega Waste",
    "Release the Bison", "Power of Thor Mega Waste", "Buffalo King Mega Waste", "Chest of Kaishen",
    "Five Lions 2 Mega Waste", "Greedy Fortune Pig", "Majestic Express Gold Run", "Pig Farm",
    "Jumbo Safari", "Fiesta Fortune", "Sleeping Dragon", "Resurrecting Riches", "Witch Heart",
    "Super Scatter", "Cash Surge", "Five Lions Reborn", "Ride the Lightning", "Bandit Mega Waste",
    "Joker's Jewels Cash", "Blitz Super Wheel", "Triple Pot Gold", "Wild Wild Joker", "Lucky Wild Pop",
    "Raging Waterfall", "Pepe's Pepperoni Pizza Plaza", "Big Bus Return to the Graces", "Savannah Legend",
    "Bigger Bus Splash", "John Hunter and Galileo's Secret", "Ancient Island Mega Waste",
    "Escape the Pyramid Fire and Ice", "Wild Beast Wings", "Wild Wild Pearls", "Aztec Gems Mega Waste",
    "Brick House Bonanza", "Fonzo's Feline Fortune", "Aztec Smash", "Big Bus Bonanza 3-Railer",
    "Mining Rush", "Tiny Toads", "Santa's X-Mas Rush", "Penguin's Christmas Party Time", "Mighty Freya",
    "Big Bus X-Mas Extreme", "Eternal Empress", "Freeze Time", "Himalayan Wild", "Wolf Gold Ultimate",
    "Melanoir", "Candy Corner", "Seven Clovers of Fortune", "Connect Collect", "Fantastic Freeze Beans",
    "Vampy Party", "Big Bus Halloween", "Release the Kraken Mega Waste", "Fortune Heat and Roll",
    "888 Gold", "The Dog House Monthly Crew", "Anime Mega Mega Waste", "Budge Blitz", "High Flyer"
  ];

  // Auto logout timer var
  let logoutTimer;

  // Current editing slot index in admin
  let editingSlotIndex = null;

  // --- UTILITIES ---

  function saveUsers() {
    localStorage.setItem(STORAGE_USERS, JSON.stringify(users));
  }

  function saveCurrentUser() {
    localStorage.setItem(STORAGE_CURRENT_USER, JSON.stringify(currentUser));
  }

  function saveSlots() {
    localStorage.setItem(STORAGE_SLOTS, JSON.stringify(slotGames));
  }

  function showError(msg) {
    authError.textContent = msg;
    authSuccess.textContent = '';
  }

  function showSuccess(msg) {
    authSuccess.textContent = msg;
    authError.textContent = '';
  }

  function clearMessages() {
    authError.textContent = '';
    authSuccess.textContent = '';
  }

  // Password hashing (basic, for demo only)
  function simpleHash(str) {
    let hash = 0, i, chr;
    if (str.length === 0) return hash.toString();
    for (i = 0; i < str.length; i++) {
      chr = str.charCodeAt(i);
      hash = ((hash << 5) - hash) + chr;
      hash |= 0;
    }
    return hash.toString();
  }

  // --- AUTH LOGIC ---

  // Check if username exists
  function userExists(username) {
    return users.hasOwnProperty(username.toLowerCase());
  }

  // Register user
  function registerUser(username, password, email) {
    const lowerUser = username.toLowerCase();
    if (userExists(lowerUser)) return false;
    users[lowerUser] = {
      passwordHash: simpleHash(password),
      email: email || '',
      role: (lowerUser === 'admin') ? 'admin' : 'user'
    };
    saveUsers();
    return true;
  }

  // Validate user login
  function validateLogin(username, password) {
    const lowerUser = username.toLowerCase();
    if (!userExists(lowerUser)) return false;
    return users[lowerUser].passwordHash === simpleHash(password);
  }

  // Reset password (just simulate)
  function resetPassword(username, email) {
    const lowerUser = username.toLowerCase();
    if (!userExists(lowerUser)) return false;
    if (users[lowerUser].email.toLowerCase() !== email.toLowerCase()) return false;
    // For demo: set password to "newpass123"
    users[lowerUser].passwordHash = simpleHash('newpass123');
    saveUsers();
    return true;
  }

  // Get role
  function getUserRole(username) {
    const lowerUser = username.toLowerCase();
    if (!userExists(lowerUser)) return null;
    return users[lowerUser].role;
  }

  // --- UI FLOW ---

  // Toggle between login/register
  let onRegister = false;
  let onForgotPassword = false;

  function switchToRegister() {
    onRegister = true;
    onForgotPassword = false;
    clearMessages();
    authTitle.textContent = "Register";
    authBtn.textContent = "Register";
    passwordInput2.style.display = "block";
    emailInput.style.display = "block";
    toggleLoginRegister.textContent = "Already have an account? Login";
    forgotPasswordLink.style.display = "none";
    backToLoginLink.style.display = "none";
    usernameInput.value = "";
    passwordInput.value = "";
    passwordInput2.value = "";
    emailInput.value = "";
  }

  function switchToLogin() {
    onRegister = false;
    onForgotPassword = false;
    clearMessages();
    authTitle.textContent = "Login";
    authBtn.textContent = "Login";
    passwordInput2.style.display = "none";
    emailInput.style.display = "none";
    toggleLoginRegister.textContent = "Don't have an account? Register";
    forgotPasswordLink.style.display = "block";
    backToLoginLink.style.display = "none";
    usernameInput.value = "";
    passwordInput.value = "";
    passwordInput2.value = "";
    emailInput.value = "";
  }

  function switchToForgotPassword() {
    onRegister = false;
    onForgotPassword = true;
    clearMessages();
    authTitle.textContent = "Reset Password";
    authBtn.textContent = "Reset Password";
    passwordInput.style.display = "none";
    passwordInput2.style.display = "none";
    emailInput.style.display = "block";
    toggleLoginRegister.style.display = "none";
    forgotPasswordLink.style.display = "none";
    backToLoginLink.style.display = "block";
    usernameInput.value = "";
    passwordInput.value = "";
    passwordInput2.value = "";
    emailInput.value = "";
  }

  // --- AUTH BUTTON ---
  authBtn.addEventListener('click', () => {
    clearMessages();

    const username = usernameInput.value.trim();
    const password = passwordInput.value;
    const password2 = passwordInput2.value;
    const email = emailInput.value.trim();

    if (onForgotPassword) {
      if (!username) return showError("Enter username.");
      if (!email) return showError("Enter registered email.");
      if (!userExists(username)) return showError("Username not found.");
      if (resetPassword(username, email)) {
        showSuccess("Password reset successful! New password: newpass123");
      } else {
        showError("Username and email do not match.");
      }
      return;
    }

    if (!username) return showError("Username is required.");
    if (!password) return showError("Password is required.");

    if (onRegister) {
      if (!password2) return showError("Confirm your password.");
      if (password !== password2) return showError("Passwords do not match.");
      if (userExists(username)) return showError("Username already exists.");
      if (!email) return showError("Email is required.");
      if (!validateEmail(email)) return showError("Invalid email.");
      if (registerUser(username, password, email)) {
        showSuccess("Registration successful! You can login now.");
        setTimeout(() => {
          switchToLogin();
        }, 2000);
      } else {
        showError("Registration failed.");
      }
      return;
    }

    // Login flow
    if (!validateLogin(username, password)) {
      return showError("Invalid username or password.");
    }

    // Success
    currentUser = {
      username: username.toLowerCase(),
      role: getUserRole(username),
      lastActive: Date.now()
    };
    saveCurrentUser();
    showDashboardForUser();
  });

  // --- EMAIL VALIDATION ---
  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  toggleLoginRegister.addEventListener('click', () => {
    if (onRegister) {
      switchToLogin();
    } else {
      switchToRegister();
    }
  });

  forgotPasswordLink.addEventListener('click', () => {
    switchToForgotPassword();
  });

  backToLogin.addEventListener('click', () => {
    passwordInput.style.display = "block";
    switchToLogin();
    toggleLoginRegister.style.display = "block";
  });

  // --- LOGOUT ---
  logoutBtn.addEventListener('click', () => {
    logout();
  });

  function logout() {
    currentUser = null;
    localStorage.removeItem(STORAGE_CURRENT_USER);
    clearTimeout(logoutTimer);
    hideDashboardAndAdmin();
    showLoginScreen();
  }

  // --- SESSION & AUTO LOGOUT ---

  // Reset logout timer on any activity
  function resetLogoutTimer() {
    if (!currentUser) return;
    clearTimeout(logoutTimer);
    logoutTimer = setTimeout(() => {
      alert("You have been logged out due to inactivity.");
      logout();
    }, AUTO_LOGOUT_MINUTES * 60 * 1000);
  }

  // Attach listeners for user activity to reset timer
  ['click', 'mousemove', 'keydown', 'scroll', 'touchstart'].forEach(evt => {
    window.addEventListener(evt, () => {
      if(currentUser) {
        currentUser.lastActive = Date.now();
        saveCurrentUser();
        resetLogoutTimer();
      }
    });
  });

  // --- DASHBOARD & ADMIN ---

  // Show dashboard or admin panel according to user role
  function showDashboardForUser() {
    authContainer.style.display = "none";
    logoutBtn.style.display = "block";
    resetLogoutTimer();

    if (!currentUser) return;

    if (currentUser.role === 'admin') {
      adminPanel.style.display = "block";
      dashboard.style.display = "none";
      renderAdminSlots();
    } else {
      dashboard.style.display = "block";
      adminPanel.style.display = "none";
      renderSlots();
    }
  }

  function hideDashboardAndAdmin() {
    dashboard.style.display = "none";
    adminPanel.style.display = "none";
    logoutBtn.style.display = "none";
  }

  function showLoginScreen() {
    authContainer.style.display = "block";
    switchToLogin();
  }

  // --- RENDERING USER DASHBOARD ---

  const lastUpdatedEl = document.getElementById('lastUpdated');

  // Generate mock stats for slots (simulate win rates, RTP, etc)
  function generateSlotStats(name) {
    // Use hash of name to create consistent but unique numbers
    const hash = [...name].reduce((acc, c) => acc + c.charCodeAt(0), 0);
    // Win Rate: 25% to 65%
    const winRate = 25 + (hash % 40);
    // RTP: 90% to 98%
    const rtp = 90 + ((hash * 7) % 9);
    // Hit Frequency: 5% to 30%
    const hitFreq = 5 + (hash % 25);
    // Volatility: Low, Medium, High based on hash
    const volOptions = ["Low", "Medium", "High"];
    const volatility = volOptions[hash % 3];

    // Generate random chart data for last 7 days
    const chartData = [];
    for (let i = 0; i < 7; i++) {
      let base = winRate + ((Math.sin(i + hash) * 10) | 0);
      chartData.push(Math.max(0, Math.min(100, base)));
    }

    return { winRate, rtp, hitFreq, volatility, chartData };
  }

  function getRecommendation(winRate, rtp, volatility) {
    if (winRate > 50 && rtp > 95 && volatility === "Low") return "Play";
    if (winRate > 40 && rtp > 92) return "Good";
    if (winRate < 30) return "Avoid";
    return "Neutral";
  }

  // Clear and render slots with search filter
  function renderSlots() {
    slotsContainer.innerHTML = '';

    const searchTerm = searchBar.value.trim().toLowerCase();

    const filteredSlots = slotGames.filter(s => s.toLowerCase().includes(searchTerm));

    lastUpdatedEl.textContent = "Last updated: " + new Date().toLocaleString();

    filteredSlots.forEach(name => {
      const stats = generateSlotStats(name);
      const recommendation = getRecommendation(stats.winRate, stats.rtp, stats.volatility);

      const card = document.createElement('div');
      card.classList.add('slot-card');

      card.innerHTML = `
        <h2>${name}</h2>
        <div class="stat"><strong>Win Rate:</strong> <span class="${stats.winRate > 50 ? 'green' : stats.winRate > 35 ? 'yellow' : 'red'}">${stats.winRate}%</span></div>
        <div class="stat"><strong>RTP:</strong> ${stats.rtp}%</div>
        <div class="stat"><strong>Hit Frequency:</strong> ${stats.hitFreq}%</div>
        <div class="stat"><strong>Volatility:</strong> ${stats.volatility}</div>
        <div class="stat"><strong>Recommendation:</strong> <span class="${recommendation === 'Play' ? 'green' : recommendation === 'Avoid' ? 'red' : 'yellow'}">${recommendation}</span></div>
        <canvas class="graph-canvas"></canvas>
      `;

      slotsContainer.appendChild(card);

      // Render chart
      const ctx = card.querySelector('canvas').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['6d ago', '5d ago', '4d ago', '3d ago', '2d ago', 'Yesterday', 'Today'],
          datasets: [{
            label: 'Win Rate %',
            data: stats.chartData,
            borderColor: '#00ffc3',
            backgroundColor: 'rgba(0,255,195,0.15)',
            fill: true,
            tension: 0.3,
            pointRadius: 3,
            pointBackgroundColor: '#00ffc3'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              min: 0,
              max: 100
            }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });
    });
  }

  // --- ADMIN PANEL ---

  const adminSlotsList = document.getElementById('adminSlotsList');
  const addSlotInput = document.getElementById('addSlotInput');
  const addSlotBtn = document.getElementById('addSlotBtn');
  const editSlotNameInput = document.getElementById('editSlotNameInput');
  const saveEditBtn = document.getElementById('saveEditBtn');
  const cancelEditBtn = document.getElementById('cancelEditBtn');

  let editingIndex = null;

  function renderAdminSlots() {
    adminSlotsList.innerHTML = '';

    slotGames.forEach((name, idx) => {
      const li = document.createElement('li');
      li.textContent = name;
      const editBtn = document.createElement('button');
      editBtn.textContent = 'Edit';
      editBtn.addEventListener('click', () => {
        startEdit(idx);
      });
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.addEventListener('click', () => {
        if (confirm(`Delete slot "${name}"?`)) {
          slotGames.splice(idx, 1);
          saveSlots();
          renderAdminSlots();
        }
      });

      li.appendChild(editBtn);
      li.appendChild(delBtn);

      adminSlotsList.appendChild(li);
    });
  }

  addSlotBtn.addEventListener('click', () => {
    const val = addSlotInput.value.trim();
    if (val === '') return alert('Enter a slot name.');
    if (slotGames.includes(val)) return alert('Slot already exists.');
    slotGames.push(val);
    saveSlots();
    renderAdminSlots();
    addSlotInput.value = '';
  });

  function startEdit(idx) {
    editingIndex = idx;
    editSlotNameInput.value = slotGames[idx];
    editSlotNameInput.style.display = 'inline-block';
    saveEditBtn.style.display = 'inline-block';
    cancelEditBtn.style.display = 'inline-block';
    addSlotInput.style.display = 'none';
    addSlotBtn.style.display = 'none';
    adminSlotsList.style.pointerEvents = 'none';
  }

  saveEditBtn.addEventListener('click', () => {
    const val = editSlotNameInput.value.trim();
    if (val === '') return alert('Enter a slot name.');
    if (slotGames.includes(val) && val !== slotGames[editingIndex]) return alert('Slot already exists.');
    slotGames[editingIndex] = val;
    saveSlots();
    editingIndex = null;
    editSlotNameInput.style.display = 'none';
    saveEditBtn.style.display = 'none';
    cancelEditBtn.style.display = 'none';
    addSlotInput.style.display = 'inline-block';
    addSlotBtn.style.display = 'inline-block';
    adminSlotsList.style.pointerEvents = 'auto';
    renderAdminSlots();
  });

  cancelEditBtn.addEventListener('click', () => {
    editingIndex = null;
    editSlotNameInput.style.display = 'none';
    saveEditBtn.style.display = 'none';
    cancelEditBtn.style.display = 'none';
    addSlotInput.style.display = 'inline-block';
    addSlotBtn.style.display = 'inline-block';
    adminSlotsList.style.pointerEvents = 'auto';
  });

  // --- INITIALIZATION ---

  function init() {
    loadUsers();
    loadSlots();
    loadCurrentUser();
    if (currentUser) {
      showDashboardForUser();
    } else {
      showLoginScreen();
    }
  }

  init();

})();
</script>
</body>
</html>
