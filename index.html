<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Slot Smith Pro - Login</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  /* Reset & basic styles */
  html, body {
    height: 100%;
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1f1f2e;
    color: #fff;
  }

  /* Body uses flexbox to center #app horizontally and vertically */
  body {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
  }

  /* Fade-in animation for login container only */
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(-10px);}
    to {opacity: 1; transform: translateY(0);}
  }

  /* Login container */
  #loginContainer {
    width: 100%;
    max-width: 400px;
    animation: fadeIn 0.6s ease forwards;
  }

  /* Main app container - centered with flex column */
  #app {
    width: 100%;
    max-width: 900px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start; /* top aligned but horizontally centered */
    min-height: 90vh;
  }

  /* Headings centered */
  h1, h2 {
    text-align: center;
    color: #00ffc3;
    margin-top: 0;
  }

  /* Hide elements */
  .hidden {
    display: none !important;
  }

  /* Inputs & buttons styling */
  input, button {
    display: block;
    width: 100%;
    margin: 10px 0;
    padding: 10px;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
    background: #2c2c3c;
    color: #fff;
    outline: none;
    box-shadow: none;
    transition: none; /* no highlight transitions */
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
  }

  /* Placeholder color */
  input::placeholder {
    color: #66fff0cc;
  }

  /* Buttons styling */
  button {
    background: #00ffc3;
    color: #000;
    font-weight: bold;
    cursor: pointer;
  }
  button:hover {
    background: #00cc9a;
  }

  /* Remove outlines and highlights on focus */
  input:focus, button:focus {
    outline: none;
    box-shadow: none;
  }

  /* Link styled buttons */
  .link-btn {
    background: none;
    border: none;
    color: #00ffc3;
    text-decoration: underline;
    cursor: pointer;
    font-size: 1rem;
    padding: 0;
    margin: 0 0 10px 0;
  }

  /* Slots container grid */
  #slotsContainer {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 30px;
    margin-top: 20px;
    width: 100%;
  }

  /* Slot cards */
  .slot-card {
    background: #2c2c3c;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  }

  .slot-card h3 {
    margin: 0 0 15px;
    color: #00d4ff;
    word-break: break-word;
  }

  .stat {
    margin: 8px 0;
    font-size: 1.1rem;
  }

  .graph-canvas {
    margin-top: 20px;
    width: 100% !important;
    max-height: 90px !important;
    height: auto !important;
  }

  /* Colors for stats */
  .green {
    color: #00ffb3;
    font-weight: 600;
  }
  .yellow {
    color: #ffd966;
    font-weight: 600;
  }
  .red {
    color: #ff6666;
    font-weight: 600;
  }

  /* Admin panel textarea */
  #adminPanel textarea {
    width: 100%;
    height: 250px;
    background: #222233;
    color: #00ffc3;
    font-family: monospace;
    font-size: 1rem;
    border-radius: 15px;
    padding: 10px;
    box-sizing: border-box;
    border: none;
    outline: none;
  }

  /* Admin panel buttons */
  #saveSlotsBtn {
    margin-top: 10px;
    width: 100%;
    background: #00cc9a;
    color: #000;
    font-weight: bold;
  }

  /* Logout and toggle buttons */
  #logoutBtn {
    margin-top: 20px;
    background: #ff4c4c;
    color: #fff;
    width: 200px;
  }

  /* Message styling */
  #message {
    text-align: center;
    margin: 10px 0;
    color: #ff5555;
    min-height: 1.2em;
  }
</style>
</head>
<body>

<!-- LOGIN CONTAINER with fade-in -->
<div id="loginContainer">
  <h1>🎰 Slot Smith Pro - Login</h1>
  <div id="message"></div>

  <form id="loginForm">
    <input type="text" id="loginUsername" placeholder="Username" required autocomplete="off" />
    <input type="password" id="loginPassword" placeholder="Password" required autocomplete="off" />
    <button type="submit">Login</button>
  </form>

  <button class="link-btn" id="showRegisterBtn">Don't have an account? Register</button>
  <button class="link-btn" id="showResetBtn">Forgot Password?</button>

  <form id="registerForm" class="hidden">
    <h2>Register</h2>
    <input type="text" id="regUsername" placeholder="Choose a username" required autocomplete="off" />
    <input type="email" id="regEmail" placeholder="Your email" required autocomplete="off" />
    <input type="password" id="regPassword" placeholder="Password" required autocomplete="off" />
    <input type="password" id="regPasswordConfirm" placeholder="Confirm Password" required autocomplete="off" />
    <button type="submit">Register</button>
    <button class="link-btn" type="button" id="backToLoginFromReg">Back to Login</button>
  </form>

  <form id="resetForm" class="hidden">
    <h2>Reset Password</h2>
    <input type="text" id="resetUsername" placeholder="Username" required autocomplete="off" />
    <input type="email" id="resetEmail" placeholder="Registered Email" required autocomplete="off" />
    <button type="submit">Reset Password</button>
    <button class="link-btn" type="button" id="backToLoginFromReset">Back to Login</button>
  </form>
</div>

<!-- MAIN APP CONTAINER -->
<div id="app" class="hidden">
  <h1>🎰 Slot Smith Pro</h1>
  <p id="lastUpdated">Last updated: --</p>
  <input type="text" id="searchBar" placeholder="Search for a slot game..." />
  <div id="slotsContainer"></div>

  <div id="adminPanel" class="hidden">
    <h2>Admin Panel: Edit Slot Games (one per line)</h2>
    <textarea id="adminTextarea"></textarea>
    <button id="saveSlotsBtn">Save Changes</button>
  </div>

  <button id="logoutBtn">Logout</button>
</div>

<script>
  // Utility helpers
  function randomFloat(min, max) {
    return (Math.random() * (max - min) + min).toFixed(2);
  }

  function generateFakeHistory() {
    return Array.from({ length: 10 }, () => parseFloat(randomFloat(0, 100)));
  }

  function recommendBet(prediction) {
    if (prediction > 80) return "High Bet";
    if (prediction > 60) return "Medium Bet";
    if (prediction > 40) return "Low Bet";
    return "Skip Bet";
  }

  function recommendBetAmount(rate) {
    if (rate > 80) return "₱1000 Max";
    if (rate > 70) return "₱500–₱999";
    if (rate > 50) return "₱200–₱499";
    if (rate > 30) return "₱50–₱199";
    return "₱0–₱49";
  }

  function recommendSpinType(avg, prediction) {
    if (prediction > 75 || (prediction - avg) > 15) return "Buy Spin (📈 High Spike)";
    if (prediction > 50) return "Normal Spin (Safe)";
    return "Avoid Spin (⚠️ Low Odds)";
  }

  function createChart(ctx, data) {
    return new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array.from({ length: data.length }, (_, i) => `T-${data.length - i}`),
        datasets: [{
          data: data,
          borderColor: 'rgba(0,255,255,0.8)',
          backgroundColor: 'rgba(0,255,255,0.2)',
          fill: true,
          tension: 0.3,
          pointRadius: 0,
          borderWidth: 2,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: { display: false },
          y: { display: false, min: 0, max: 100 }
        },
        plugins: {
          legend: { display: false },
          tooltip: { enabled: false }
        },
        elements: {
          line: { borderJoinStyle: 'round' }
        }
      }
    });
  }

  // Slot games initial list
  let slotGames = [
    "7 Coins",
    "7 Koi Gate",
    "Aztec Gems",
    "Sweet Bonanza",
    "Crypto Gold",
    "Chilli Heat",
    "Dolphin Reef",
    "Fire Strike",
    "Wolf Gold",
    "Dog House",
  ];

  let slotsData = [];
  let isAdmin = false;
  let isUserMode = false;

  // DOM elements
  const loginContainer = document.getElementById('loginContainer');
  const appContainer = document.getElementById('app');
  const messageDiv = document.getElementById('message');

  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  const resetForm = document.getElementById('resetForm');

  const showRegisterBtn = document.getElementById('showRegisterBtn');
  const showResetBtn = document.getElementById('showResetBtn');
  const backToLoginFromReg = document.getElementById('backToLoginFromReg');
  const backToLoginFromReset = document.getElementById('backToLoginFromReset');

  const logoutBtn = document.getElementById('logoutBtn');
  const slotsContainer = document.getElementById('slotsContainer');
  const searchBar = document.getElementById('searchBar');
  const lastUpdated = document.getElementById('lastUpdated');

  const adminPanel = document.getElementById('adminPanel');
  const adminTextarea = document.getElementById('adminTextarea');
  const saveSlotsBtn = document.getElementById('saveSlotsBtn');

  // Authentication simulation: store users in localStorage
  // Users structure: {username: {password, email, isAdmin}}
  function getUsers() {
    return JSON.parse(localStorage.getItem('users') || '{}');
  }

  function saveUsers(users) {
    localStorage.setItem('users', JSON.stringify(users));
  }

  function getCurrentUser() {
    return JSON.parse(localStorage.getItem('currentUser') || 'null');
  }

  function setCurrentUser(user) {
    localStorage.setItem('currentUser', JSON.stringify(user));
  }

  // Slots data persistence (saved in localStorage)
  function saveSlotsData() {
    localStorage.setItem('slotsData', JSON.stringify(slotGames));
  }

  function loadSlotsData() {
    const saved = localStorage.getItem('slotsData');
    if (saved) {
      try {
        const parsed = JSON.parse(saved);
        if (Array.isArray(parsed)) slotGames = parsed;
      } catch { }
    }
  }

  // Show message
  function showMessage(text, isError = true) {
    messageDiv.textContent = text;
    messageDiv.style.color = isError ? '#ff5555' : '#00ffb3';
    if (text) {
      setTimeout(() => { messageDiv.textContent = ''; }, 4000);
    }
  }

  // Login flow
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value;

    const users = getUsers();
    if (!users[username]) {
      showMessage("User does not exist.");
      return;
    }
    if (users[username].password !== password) {
      showMessage("Incorrect password.");
      return;
    }
    setCurrentUser({ username, isAdmin: !!users[username].isAdmin });
    isAdmin = !!users[username].isAdmin;
    isUserMode = !isAdmin; // user mode = not admin
    loadSlotsData();
    showApp();
    showMessage("Login successful!", false);
  });

  // Register flow
  registerForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('regUsername').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const password = document.getElementById('regPassword').value;
    const confirmPassword = document.getElementById('regPasswordConfirm').value;

    if (password !== confirmPassword) {
      showMessage("Passwords do not match.");
      return;
    }

    const users = getUsers();
    if (users[username]) {
      showMessage("Username already taken.");
      return;
    }

    users[username] = { password, email, isAdmin: false };
    saveUsers(users);
    showMessage("Registered successfully! Please login.", false);

    // Switch back to login form
    showLoginForm();
  });

  // Reset password flow (simulated)
  resetForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('resetUsername').value.trim();
    const email = document.getElementById('resetEmail').value.trim();

    const users = getUsers();
    if (!users[username]) {
      showMessage("User does not exist.");
      return;
    }
    if (users[username].email !== email) {
      showMessage("Email does not match our records.");
      return;
    }
    // For demo, just reset password to 'password123'
    users[username].password = 'password123';
    saveUsers(users);
    showMessage("Password reset to 'password123'. Please login.", false);
    showLoginForm();
  });

  // Show login form, hide others
  function showLoginForm() {
    loginForm.classList.remove('hidden');
    registerForm.classList.add('hidden');
    resetForm.classList.add('hidden');
  }

  // Show register form
  showRegisterBtn.addEventListener('click', () => {
    loginForm.classList.add('hidden');
    registerForm.classList.remove('hidden');
    resetForm.classList.add('hidden');
  });

  backToLoginFromReg.addEventListener('click', () => {
    showLoginForm();
  });

  // Show reset form
  showResetBtn.addEventListener('click', () => {
    loginForm.classList.add('hidden');
    registerForm.classList.add('hidden');
    resetForm.classList.remove('hidden');
  });

  backToLoginFromReset.addEventListener('click', () => {
    showLoginForm();
  });

  // Logout
  logoutBtn.addEventListener('click', () => {
    setCurrentUser(null);
    slotGames = [];
    slotsData = [];
    isAdmin = false;
    isUserMode = false;
    appContainer.classList.add('hidden');
    loginContainer.classList.remove('hidden');
    showLoginForm();
  });

  // Render slots with charts and stats
  function renderSlots(filter = '') {
    slotsContainer.innerHTML = '';
    const filteredSlots = slotGames.filter(slot =>
      slot.toLowerCase().includes(filter.toLowerCase())
    );
    if (filteredSlots.length === 0) {
      slotsContainer.innerHTML = '<p>No slot games found.</p>';
      return;
    }

    filteredSlots.forEach((slot, idx) => {
      // Generate fake data on the fly for demo
      const prediction = parseFloat(randomFloat(0, 100));
      const averageRate = parseFloat(randomFloat(40, 75));
      const lastTen = generateFakeHistory();

      const bet = recommendBet(prediction);
      const betAmount = recommendBetAmount(prediction);
      const spinType = recommendSpinType(averageRate, prediction);

      // Color coding for average rate
      let avgClass = 'green';
      if (averageRate < 45) avgClass = 'red';
      else if (averageRate < 55) avgClass = 'yellow';

      // Create card element
      const card = document.createElement('div');
      card.className = 'slot-card';

      card.innerHTML = `
        <h3>${slot}</h3>
        <div class="stat">Average Rate: <span class="${avgClass}">${averageRate}%</span></div>
        <div class="stat">Prediction: <span class="green">${prediction}%</span></div>
        <div class="stat">Bet: <span>${bet}</span></div>
        <div class="stat">Bet Amount: <span>${betAmount}</span></div>
        <div class="stat">Spin Type: <span>${spinType}</span></div>
        <canvas id="chart-${idx}" class="graph-canvas"></canvas>
      `;

      slotsContainer.appendChild(card);

      // Create chart
      const ctx = document.getElementById(`chart-${idx}`).getContext('2d');
      createChart(ctx, lastTen);
    });
  }

  // Search filter
  searchBar.addEventListener('input', () => {
    renderSlots(searchBar.value);
  });

  // Admin panel toggle
  function showAdminPanel(show) {
    adminPanel.classList.toggle('hidden', !show);
  }

  // Populate admin textarea from slotGames
  function loadAdminTextarea() {
    adminTextarea.value = slotGames.join('\n');
  }

  // Save changes from admin textarea
  saveSlotsBtn.addEventListener('click', () => {
    const lines = adminTextarea.value.split('\n')
      .map(line => line.trim())
      .filter(line => line.length > 0);
    if (lines.length === 0) {
      alert("Slot list cannot be empty.");
      return;
    }
    slotGames = lines;
    saveSlotsData();
    renderSlots(searchBar.value);
    alert("Slot list saved.");
  });

  // Show app after login
  function showApp() {
    loginContainer.classList.add('hidden');
    appContainer.classList.remove('hidden');
    lastUpdated.textContent = "Last updated: " + new Date().toLocaleString();
    renderSlots();

    if (isAdmin) {
      showAdminPanel(true);
      loadAdminTextarea();
    } else {
      showAdminPanel(false);
    }
  }

  // On page load, check if user is logged in
  window.addEventListener('load', () => {
    const currentUser = getCurrentUser();
    if (currentUser) {
      isAdmin = currentUser.isAdmin;
      isUserMode = !isAdmin;
      loadSlotsData();
      showApp();
    } else {
      showLoginForm();
    }

    // Ensure login container visible, app hidden if no user
    if (!currentUser) {
      appContainer.classList.add('hidden');
      loginContainer.classList.remove('hidden');
    }
  });
</script>

</body>
</html>
