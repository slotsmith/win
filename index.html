<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Slot Smith Pro - Login</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1f1f2e;
    color: #fff;
    margin: 0;
    padding: 20px;
  }
  h1, h2 {
    text-align: center;
    color: #00ffc3;
  }
  #app, #loginContainer {
    max-width: 900px;
    margin: auto;
  }
  .hidden {
    display: none;
  }
  input, button {
    display: block;
    width: 100%;
    margin: 10px auto;
    padding: 10px;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
  }
  input {
    background: #2c2c3c;
    color: #fff;
  }
  input::placeholder {
    color: #66fff0cc;
  }
  button {
    background: #00ffc3;
    color: #000;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background: #00cc9a;
  }
  #slotsContainer {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 30px;
    margin-top: 20px;
  }
  .slot-card {
    background: #2c2c3c;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  }
  .slot-card h3 {
    margin: 0 0 15px;
    color: #00d4ff;
    word-break: break-word;
  }
  .stat {
    margin: 8px 0;
    font-size: 1.1rem;
  }
  .graph-canvas {
    margin-top: 20px;
    width: 100% !important;
    max-height: 90px !important;
    height: auto !important;
  }
  .green {
    color: #00ffb3;
    font-weight: 600;
  }
  .yellow {
    color: #ffd966;
    font-weight: 600;
  }
  .red {
    color: #ff6666;
    font-weight: 600;
  }
  #adminPanel textarea {
    width: 100%;
    height: 250px;
    background: #222233;
    color: #00ffc3;
    font-family: monospace;
    font-size: 1rem;
    border-radius: 15px;
    padding: 10px;
    box-sizing: border-box;
  }
  #logoutBtn {
    margin-top: 20px;
    background: #ff4c4c;
    color: #fff;
  }
  #toggleModeBtn {
    margin-top: 10px;
    background: #0077cc;
    color: #fff;
  }
  #message {
    text-align: center;
    margin: 10px 0;
    color: #ff5555;
  }
  .link-btn {
    background: none;
    border: none;
    color: #00ffc3;
    text-decoration: underline;
    cursor: pointer;
    font-size: 1rem;
    padding: 0;
    margin: 0 0 10px 0;
  }
</style>
</head>
<body>

<div id="loginContainer">
  <h1>ðŸŽ° Slot Smith Pro - Login</h1>
  <div id="message"></div>

  <form id="loginForm">
    <input type="text" id="loginUsername" placeholder="Username" required autocomplete="off" />
    <input type="password" id="loginPassword" placeholder="Password" required autocomplete="off" />
    <button type="submit">Login</button>
  </form>

  <button class="link-btn" id="showRegisterBtn">Don't have an account? Register</button>
  <button class="link-btn" id="showResetBtn">Forgot Password?</button>

  <form id="registerForm" class="hidden">
    <h2>Register</h2>
    <input type="text" id="regUsername" placeholder="Choose a username" required autocomplete="off" />
    <input type="email" id="regEmail" placeholder="Your email" required autocomplete="off" />
    <input type="password" id="regPassword" placeholder="Password" required autocomplete="off" />
    <input type="password" id="regPasswordConfirm" placeholder="Confirm Password" required autocomplete="off" />
    <button type="submit">Register</button>
    <button class="link-btn" type="button" id="backToLoginFromReg">Back to Login</button>
  </form>

  <form id="resetForm" class="hidden">
    <h2>Reset Password</h2>
    <input type="text" id="resetUsername" placeholder="Username" required autocomplete="off" />
    <input type="email" id="resetEmail" placeholder="Registered Email" required autocomplete="off" />
    <button type="submit">Reset Password</button>
    <button class="link-btn" type="button" id="backToLoginFromReset">Back to Login</button>
  </form>
</div>

<div id="app" class="hidden">
  <h1>ðŸŽ° Slot Smith Pro</h1>
  <p id="lastUpdated">Last updated: --</p>
  <input type="text" id="searchBar" placeholder="Search for a slot game..." />
  <div id="slotsContainer"></div>

  <div id="adminPanel" class="hidden">
    <h2>Admin Panel: Edit Slot Games (one per line)</h2>
    <textarea id="adminTextarea"></textarea>
    <button id="saveSlotsBtn">Save Changes</button>
  </div>

  <button id="logoutBtn">Logout</button>
</div>

<script>
  // Utility functions
  function randomFloat(min, max) {
    return (Math.random() * (max - min) + min).toFixed(2);
  }

  function generateFakeHistory() {
    return Array.from({ length: 10 }, () => parseFloat(randomFloat(0, 100)));
  }

  function recommendBet(prediction) {
    if (prediction > 80) return "High Bet";
    if (prediction > 60) return "Medium Bet";
    if (prediction > 40) return "Low Bet";
    return "Skip Bet";
  }

  function recommendBetAmount(rate) {
    if (rate > 80) return "â‚±1000 Max";
    if (rate > 70) return "â‚±500â€“â‚±999";
    if (rate > 50) return "â‚±200â€“â‚±499";
    if (rate > 30) return "â‚±50â€“â‚±199";
    return "â‚±0â€“â‚±49";
  }

  function recommendSpinType(avg, prediction) {
    if (prediction > 75 || (prediction - avg) > 15) return "Buy Spin (ðŸ“ˆ High Spike)";
    if (prediction > 50) return "Normal Spin (Safe)";
    return "Avoid Spin (âš ï¸ Low Odds)";
  }

  function createChart(ctx, data) {
    return new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array.from({ length: data.length }, (_, i) => `T-${data.length - i}`),
        datasets: [{
          label: 'Win % History',
          data,
          borderColor: '#00ffc3',
          backgroundColor: 'rgba(0,255,195,0.1)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100
          }
        }
      }
    });
  }

  // Local storage keys
  const USERS_KEY = "ssp_users";
  const SLOTS_KEY = "ssp_slots";
  const CURRENT_USER_KEY = "ssp_currentUser";

  // Elements
  const loginContainer = document.getElementById('loginContainer');
  const app = document.getElementById('app');

  const loginForm = document.getElementById('loginForm');
  const loginUsername = document.getElementById('loginUsername');
  const loginPassword = document.getElementById('loginPassword');
  const message = document.getElementById('message');

  const registerForm = document.getElementById('registerForm');
  const regUsername = document.getElementById('regUsername');
  const regEmail = document.getElementById('regEmail');
  const regPassword = document.getElementById('regPassword');
  const regPasswordConfirm = document.getElementById('regPasswordConfirm');

  const resetForm = document.getElementById('resetForm');
  const resetUsername = document.getElementById('resetUsername');
  const resetEmail = document.getElementById('resetEmail');

  const showRegisterBtn = document.getElementById('showRegisterBtn');
  const showResetBtn = document.getElementById('showResetBtn');
  const backToLoginFromReg = document.getElementById('backToLoginFromReg');
  const backToLoginFromReset = document.getElementById('backToLoginFromReset');

  const logoutBtn = document.getElementById('logoutBtn');
  const searchBar = document.getElementById('searchBar');
  const slotsContainer = document.getElementById('slotsContainer');

  const adminPanel = document.getElementById('adminPanel');
  const adminTextarea = document.getElementById('adminTextarea');
  const saveSlotsBtn = document.getElementById('saveSlotsBtn');

  // Globals
  let currentUser = null;
  let slotGames = [];

  // Load users from localStorage or return empty array
  function loadUsers() {
    const usersJson = localStorage.getItem(USERS_KEY);
    if (!usersJson) return [];
    try {
      return JSON.parse(usersJson);
    } catch {
      return [];
    }
  }

  // Save users to localStorage
  function saveUsers(users) {
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
  }

  // Load slot games list from localStorage or default list if none
  function loadSlotGames() {
    const slotsJson = localStorage.getItem(SLOTS_KEY);
    if (!slotsJson) {
      // Default slot games array (some popular ones)
      return [
        "Sweet Bonanza", "Gates of Olympus", "Starlight Princess", "Sugar Rush", "Big Bass Splash",
        "Wild West Gold", "The Dog House", "Power of Thor Megaways", "Jokerâ€™s Jewels", "Floating Dragon"
      ];
    }
    try {
      return JSON.parse(slotsJson);
    } catch {
      return [];
    }
  }

  // Save slot games to localStorage
  function saveSlotGames(slots) {
    localStorage.setItem(SLOTS_KEY, JSON.stringify(slots));
  }

  // Save current user to localStorage
  function saveCurrentUser(user) {
    localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(user));
  }

  // Load current user from localStorage
  function loadCurrentUser() {
    const userJson = localStorage.getItem(CURRENT_USER_KEY);
    if (!userJson) return null;
    try {
      return JSON.parse(userJson);
    } catch {
      return null;
    }
  }

  // Show message for a few seconds
  function showMessage(text, isError = true) {
    message.style.color = isError ? '#ff5555' : '#00ffc3';
    message.textContent = text;
    setTimeout(() => {
      message.textContent = '';
    }, 5000);
  }

  // Switch UI between login, register, reset, and main app
  function showLogin() {
    loginContainer.classList.remove('hidden');
    app.classList.add('hidden');
    registerForm.classList.add('hidden');
    resetForm.classList.add('hidden');
    loginForm.classList.remove('hidden');
    message.textContent = '';
  }

  function showRegister() {
    registerForm.classList.remove('hidden');
    loginForm.classList.add('hidden');
    resetForm.classList.add('hidden');
    message.textContent = '';
  }

  function showReset() {
    resetForm.classList.remove('hidden');
    loginForm.classList.add('hidden');
    registerForm.classList.add('hidden');
    message.textContent = '';
  }

  function showApp() {
    loginContainer.classList.add('hidden');
    app.classList.remove('hidden');
    message.textContent = '';
  }

  // Validate registration form inputs
  function validateRegistration(username, email, password, confirm) {
    if (!username.trim() || !email.trim() || !password || !confirm) {
      showMessage("Please fill in all fields.");
      return false;
    }
    if (password !== confirm) {
      showMessage("Passwords do not match.");
      return false;
    }
    if (!email.includes("@")) {
      showMessage("Invalid email.");
      return false;
    }
    return true;
  }

  // Register new user
  function registerUser(username, email, password) {
    const users = loadUsers();
    if (users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
      showMessage("Username already exists.");
      return false;
    }
    if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
      showMessage("Email already registered.");
      return false;
    }
    const newUser = {
      username,
      email,
      password,
      role: username.toLowerCase() === "admin" ? "admin" : "user"
    };
    users.push(newUser);
    saveUsers(users);
    showMessage("Registration successful! Please login.", false);
    return true;
  }

  // Login user
  function loginUser(username, password) {
    const users = loadUsers();
    const user = users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.password === password);
    if (!user) {
      showMessage("Invalid username or password.");
      return null;
    }
    return user;
  }

  // Reset password (set to 'newpass123')
  function resetPassword(username, email) {
    const users = loadUsers();
    const userIndex = users.findIndex(u => u.username.toLowerCase() === username.toLowerCase() && u.email.toLowerCase() === email.toLowerCase());
    if (userIndex === -1) {
      showMessage("User not found or email does not match.");
      return false;
    }
    users[userIndex].password = "newpass123";
    saveUsers(users);
    showMessage("Password reset. Use 'newpass123' to login and change it.", false);
    return true;
  }

  // Render slot cards on page
  function renderSlots(games) {
    slotsContainer.innerHTML = "";
    games.forEach(slot => {
      const history = generateFakeHistory();
      const avg = (history.reduce((a, b) => a + b) / history.length).toFixed(2);
      const prediction = parseFloat(randomFloat(0, 100));
      const recommendedBet = recommendBet(prediction);
      const recommendedAmount = recommendBetAmount(prediction);
      const recommendedSpin = recommendSpinType(avg, prediction);

      const slotCard = document.createElement('div');
      slotCard.className = 'slot-card';

      slotCard.innerHTML = `
        <h3>${slot}</h3>
        <div class="stat">Average Win Rate: <span class="yellow">${avg}%</span></div>
        <div class="stat">Prediction: <span class="green">${prediction}%</span></div>
        <div class="stat">Recommended Bet: <span class="green">${recommendedBet}</span></div>
        <div class="stat">Recommended Bet Amount: <span class="green">${recommendedAmount}</span></div>
        <div class="stat">Recommended Spin: <span class="green">${recommendedSpin}</span></div>
        <canvas class="graph-canvas"></canvas>
      `;

      slotsContainer.appendChild(slotCard);

      // Chart.js for graph
      const ctx = slotCard.querySelector('canvas').getContext('2d');
      createChart(ctx, history);
    });
  }

  // Filter slots by search query
  function filterSlots(query) {
    query = query.trim().toLowerCase();
    const filtered = slotGames.filter(s => s.toLowerCase().includes(query));
    renderSlots(filtered);
  }

  // Setup event handlers
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const user = loginUser(loginUsername.value.trim(), loginPassword.value);
    if (user) {
      currentUser = user;
      saveCurrentUser(user);
      startApp();
    }
  });

  registerForm.addEventListener('submit', e => {
    e.preventDefault();
    if (validateRegistration(regUsername.value, regEmail.value, regPassword.value, regPasswordConfirm.value)) {
      if (registerUser(regUsername.value.trim(), regEmail.value.trim(), regPassword.value)) {
        showLogin();
      }
    }
  });

  resetForm.addEventListener('submit', e => {
    e.preventDefault();
    if (resetPassword(resetUsername.value.trim(), resetEmail.value.trim())) {
      showLogin();
    }
  });

  showRegisterBtn.addEventListener('click', () => showRegister());
  backToLoginFromReg.addEventListener('click', () => showLogin());
  showResetBtn.addEventListener('click', () => showReset());
  backToLoginFromReset.addEventListener('click', () => showLogin());

  logoutBtn.addEventListener('click', () => {
    currentUser = null;
    localStorage.removeItem(CURRENT_USER_KEY);
    showLogin();
  });

  searchBar.addEventListener('input', e => {
    filterSlots(e.target.value);
  });

  saveSlotsBtn.addEventListener('click', () => {
    // Parse textarea lines
    const lines = adminTextarea.value.split('\n')
      .map(l => l.trim())
      .filter(l => l.length > 0);
    slotGames = lines;
    saveSlotGames(slotGames);
    renderSlots(slotGames);
    alert("Slot games list saved!");
  });

  // Start main app view after login
  function startApp() {
    slotGames = loadSlotGames();
    showApp();

    document.getElementById('lastUpdated').textContent = 'Last updated: ' + new Date().toLocaleString();

    if (currentUser.role === "admin") {
      adminPanel.classList.remove('hidden');
      adminTextarea.value = slotGames.join('\n');
    } else {
      adminPanel.classList.add('hidden');
    }

    renderSlots(slotGames);
  }

  // On page load, check if already logged in
  window.addEventListener('load', () => {
    currentUser = loadCurrentUser();
    if (currentUser) {
      startApp();
    } else {
      showLogin();
    }
  });
</script>
</body>
</html>
