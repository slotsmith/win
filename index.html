<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Slot Smith Pro - Login</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #1f1f2e;
    color: #fff;
    margin: 0;
    padding: 20px;
  }
  h1, h2 {
    text-align: center;
    color: #00ffc3;
  }
  #app, #loginContainer {
    max-width: 900px;
    margin: auto;
  }
  .hidden {
    display: none;
  }
  input, button {
    display: block;
    width: 100%;
    margin: 10px auto;
    padding: 10px;
    border-radius: 10px;
    border: none;
    font-size: 1rem;
  }
  input {
    background: #2c2c3c;
    color: #fff;
  }
  input::placeholder {
    color: #66fff0cc;
  }
  button {
    background: #00ffc3;
    color: #000;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background: #00cc9a;
  }
  #slotsContainer {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 30px;
    margin-top: 20px;
  }
  .slot-card {
    background: #2c2c3c;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  }
  .slot-card h3 {
    margin: 0 0 15px;
    color: #00d4ff;
    word-break: break-word;
  }
  .stat {
    margin: 8px 0;
    font-size: 1.1rem;
  }
  .graph-canvas {
    margin-top: 20px;
    width: 100% !important;
    max-height: 90px !important;
    height: auto !important;
  }
  .green {
    color: #00ffb3;
    font-weight: 600;
  }
  .yellow {
    color: #ffd966;
    font-weight: 600;
  }
  .red {
    color: #ff6666;
    font-weight: 600;
  }
  #adminPanel textarea {
    width: 100%;
    height: 250px;
    background: #222233;
    color: #00ffc3;
    font-family: monospace;
    font-size: 1rem;
    border-radius: 15px;
    padding: 10px;
    box-sizing: border-box;
  }
  #logoutBtn {
    margin-top: 20px;
    background: #ff4c4c;
    color: #fff;
  }
  #toggleModeBtn {
    margin-top: 10px;
    background: #0077cc;
    color: #fff;
  }
  #message {
    text-align: center;
    margin: 10px 0;
    color: #ff5555;
  }
  .link-btn {
    background: none;
    border: none;
    color: #00ffc3;
    text-decoration: underline;
    cursor: pointer;
    font-size: 1rem;
    padding: 0;
    margin: 0 0 10px 0;
  }
</style>
</head>
<body>

<div id="loginContainer">
  <h1>ðŸŽ° Slot Smith Pro - Login</h1>
  <div id="message"></div>

  <form id="loginForm">
    <input type="text" id="loginUsername" placeholder="Username" required autocomplete="off" />
    <input type="password" id="loginPassword" placeholder="Password" required autocomplete="off" />
    <button type="submit">Login</button>
  </form>

  <button class="link-btn" id="showRegisterBtn">Don't have an account? Register</button>
  <button class="link-btn" id="showResetBtn">Forgot Password?</button>

  <form id="registerForm" class="hidden">
    <h2>Register</h2>
    <input type="text" id="regUsername" placeholder="Choose a username" required autocomplete="off" />
    <input type="email" id="regEmail" placeholder="Your email" required autocomplete="off" />
    <input type="password" id="regPassword" placeholder="Password" required autocomplete="off" />
    <input type="password" id="regPasswordConfirm" placeholder="Confirm Password" required autocomplete="off" />
    <button type="submit">Register</button>
    <button class="link-btn" type="button" id="backToLoginFromReg">Back to Login</button>
  </form>

  <form id="resetForm" class="hidden">
    <h2>Reset Password</h2>
    <input type="text" id="resetUsername" placeholder="Username" required autocomplete="off" />
    <input type="email" id="resetEmail" placeholder="Registered Email" required autocomplete="off" />
    <button type="submit">Reset Password</button>
    <button class="link-btn" type="button" id="backToLoginFromReset">Back to Login</button>
  </form>
</div>

<div id="app" class="hidden">
  <h1>ðŸŽ° Slot Smith Pro</h1>
  <p id="lastUpdated">Last updated: --</p>
  <input type="text" id="searchBar" placeholder="Search for a slot game..." />
  <div id="slotsContainer"></div>

  <div id="adminPanel" class="hidden">
    <h2>Admin Panel: Edit Slot Games (one per line)</h2>
    <textarea id="adminTextarea"></textarea>
    <button id="saveSlotsBtn">Save Changes</button>
  </div>

  <button id="logoutBtn">Logout</button>
</div>

<script>
  // Utility functions
  function randomFloat(min, max) {
    return (Math.random() * (max - min) + min).toFixed(2);
  }

  function generateFakeHistory() {
    return Array.from({ length: 10 }, () => parseFloat(randomFloat(0, 100)));
  }

  function recommendBet(prediction) {
    if (prediction > 80) return "High Bet";
    if (prediction > 60) return "Medium Bet";
    if (prediction > 40) return "Low Bet";
    return "Skip Bet";
  }

  function recommendBetAmount(rate) {
    if (rate > 80) return "â‚±1000 Max";
    if (rate > 70) return "â‚±500â€“â‚±999";
    if (rate > 50) return "â‚±200â€“â‚±499";
    if (rate > 30) return "â‚±50â€“â‚±199";
    return "â‚±0â€“â‚±49";
  }

  function recommendSpinType(avg, prediction) {
    if (prediction > 75 || (prediction - avg) > 15) return "Buy Spin (ðŸ“ˆ High Spike)";
    if (prediction > 50) return "Normal Spin (Safe)";
    return "Avoid Spin (âš ï¸ Low Odds)";
  }

  function createChart(ctx, data) {
    return new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array.from({ length: data.length }, (_, i) => `T-${data.length - i}`),
        datasets: [{
          label: 'Win % History',
          data,
          borderColor: '#00ffc3',
          backgroundColor: 'rgba(0,255,195,0.1)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100
          }
        }
      }
    });
  }

  // Local storage keys
  const USERS_KEY = "ssp_users";
  const SLOTS_KEY = "ssp_slots";
  const CURRENT_USER_KEY = "ssp_currentUser";

  // Elements
  const loginContainer = document.getElementById('loginContainer');
  const app = document.getElementById('app');

  const loginForm = document.getElementById('loginForm');
  const loginUsername = document.getElementById('loginUsername');
  const loginPassword = document.getElementById('loginPassword');
  const message = document.getElementById('message');

  const registerForm = document.getElementById('registerForm');
  const regUsername = document.getElementById('regUsername');
  const regEmail = document.getElementById('regEmail');
  const regPassword = document.getElementById('regPassword');
  const regPasswordConfirm = document.getElementById('regPasswordConfirm');

  const resetForm = document.getElementById('resetForm');
  const resetUsername = document.getElementById('resetUsername');
  const resetEmail = document.getElementById('resetEmail');

  const showRegisterBtn = document.getElementById('showRegisterBtn');
  const showResetBtn = document.getElementById('showResetBtn');
  const backToLoginFromReg = document.getElementById('backToLoginFromReg');
  const backToLoginFromReset = document.getElementById('backToLoginFromReset');

  const logoutBtn = document.getElementById('logoutBtn');
  const slotsContainer = document.getElementById('slotsContainer');
  const lastUpdated = document.getElementById('lastUpdated');

  const searchBar = document.getElementById('searchBar');

  const adminPanel = document.getElementById('adminPanel');
  const adminTextarea = document.getElementById('adminTextarea');
  const saveSlotsBtn = document.getElementById('saveSlotsBtn');

  // Load users from localStorage
  function loadUsers() {
    const raw = localStorage.getItem(USERS_KEY);
    return raw ? JSON.parse(raw) : [];
  }

  // Save users to localStorage
  function saveUsers(users) {
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
  }

  // Load slots from localStorage or create initial slots
  function loadSlots() {
    const raw = localStorage.getItem(SLOTS_KEY);
    if (raw) return JSON.parse(raw);

    // Initial slots list - example, you can customize this list
    const initialSlots = [
      "Sweet Bonanza",
      "Sweet Bonanza Xmas",
      "Gates of Olympus",
      "The Dog House",
      "The Dog House Megaways",
      "Jungle Delight",
      "Madame Destiny Megaways",
      "Release the Kraken",
      "Wild West Gold",
      "Fruit Party",
      "Panda's Fortune",
      "Magic Crystals",
      "John Hunter and the Tomb of the Scarab Queen",
      "Safari Gold Megaways",
      "Wolf Gold",
      "Hot to Burn",
      "Pirate Gold",
      "John Hunter and the Book of Tut",
      "Caishen Wins",
      "John Hunter and the Mayan Gods"
    ];
    localStorage.setItem(SLOTS_KEY, JSON.stringify(initialSlots));
    return initialSlots;
  }

  // Save slots list
  function saveSlots(slots) {
    localStorage.setItem(SLOTS_KEY, JSON.stringify(slots));
  }

  // Show message text, isError defaults to true for red color
  function showMessage(text, isError = true) {
    message.textContent = text;
    message.style.color = isError ? '#ff5555' : '#00ff99';
    setTimeout(() => {
      message.textContent = '';
    }, 4000);
  }

  // Register user function with single admin enforcement
  function registerUser(username, email, password) {
    const users = loadUsers();

    if (users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
      showMessage("Username already exists.");
      return false;
    }

    if (users.find(u => u.email.toLowerCase() === email.toLowerCase())) {
      showMessage("Email already registered.");
      return false;
    }

    // SINGLE ADMIN ENFORCEMENT:
    if (username.toLowerCase() === "admin") {
      if (users.some(u => u.role === "admin")) {
        showMessage("Admin user already exists. Cannot create another.");
        return false;
      }
    }

    const newUser = {
      username,
      email,
      password,
      role: username.toLowerCase() === "admin" ? "admin" : "user"
    };

    users.push(newUser);
    saveUsers(users);
    showMessage("Registration successful! Please login.", false);
    return true;
  }

  // Login user
  function loginUser(username, password) {
    const users = loadUsers();
    const user = users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.password === password);
    if (user) {
      localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(user));
      return user;
    }
    return null;
  }

  // Logout user
  function logoutUser() {
    localStorage.removeItem(CURRENT_USER_KEY);
    location.reload();
  }

  // Get current logged-in user
  function getCurrentUser() {
    const raw = localStorage.getItem(CURRENT_USER_KEY);
    return raw ? JSON.parse(raw) : null;
  }

  // Show login form
  function showLogin() {
    loginContainer.style.display = "block";
    app.style.display = "none";
    registerForm.classList.add("hidden");
    resetForm.classList.add("hidden");
    loginForm.classList.remove("hidden");
    message.textContent = "";
  }

  // Show register form
  function showRegister() {
    loginForm.classList.add("hidden");
    registerForm.classList.remove("hidden");
    resetForm.classList.add("hidden");
    message.textContent = "";
  }

  // Show reset form
  function showReset() {
    loginForm.classList.add("hidden");
    registerForm.classList.add("hidden");
    resetForm.classList.remove("hidden");
    message.textContent = "";
  }

  // Show main app
  function showApp(user) {
    loginContainer.style.display = "none";
    app.style.display = "block";
    message.textContent = "";
    if (user.role === "admin") {
      adminPanel.classList.remove("hidden");
      loadAdminSlots();
    } else {
      adminPanel.classList.add("hidden");
    }
    loadAndRenderSlots();
  }

  // Load and render slots with fake stats
  function loadAndRenderSlots() {
    let slots = loadSlots();

    const now = new Date();
    lastUpdated.textContent = `Last updated: ${now.toLocaleString()}`;

    slotsContainer.innerHTML = "";

    slots.forEach(slotName => {
      // Generate fake stats for display
      const hitRate = parseFloat(randomFloat(20, 90));
      const winRate = parseFloat(randomFloat(20, 90));
      const prediction = parseFloat(randomFloat(20, 90));
      const averageWin = parseFloat(randomFloat(30, 70));
      const history = generateFakeHistory();

      const betRecommendation = recommendBet(prediction);
      const betAmountRecommendation = recommendBetAmount(hitRate);
      const spinTypeRecommendation = recommendSpinType(averageWin, prediction);

      // Create slot card div
      const card = document.createElement('div');
      card.className = "slot-card";

      card.innerHTML = `
        <h3>${slotName}</h3>
        <div class="stat">Hit Rate: <span class="${hitRate > 50 ? 'green' : 'red'}">${hitRate}%</span></div>
        <div class="stat">Win Rate: <span class="${winRate > 50 ? 'green' : 'red'}">${winRate}%</span></div>
        <div class="stat">Prediction: <span class="${prediction > 50 ? 'green' : 'red'}">${prediction}%</span></div>
        <div class="stat">Average Win: <span class="${averageWin > 50 ? 'green' : 'red'}">${averageWin}%</span></div>
        <div class="stat">Bet Recommendation: <strong>${betRecommendation}</strong></div>
        <div class="stat">Bet Amount: <strong>${betAmountRecommendation}</strong></div>
        <div class="stat">Spin Type: <strong>${spinTypeRecommendation}</strong></div>
        <canvas class="graph-canvas"></canvas>
      `;

      slotsContainer.appendChild(card);

      // Render chart
      const ctx = card.querySelector('canvas').getContext('2d');
      createChart(ctx, history);
    });
  }

  // Admin: Load slots into textarea
  function loadAdminSlots() {
    const slots = loadSlots();
    adminTextarea.value = slots.join('\n');
  }

  // Admin: Save slots from textarea
  function saveAdminSlots() {
    const lines = adminTextarea.value.split('\n')
      .map(line => line.trim())
      .filter(line => line.length > 0);

    if (lines.length === 0) {
      alert("Slot list cannot be empty.");
      return;
    }

    saveSlots(lines);
    showMessage("Slots list updated.", false);
    loadAndRenderSlots();
  }

  // Reset password (just update password if username and email match)
  function resetPassword(username, email) {
    const users = loadUsers();
    const user = users.find(u => u.username.toLowerCase() === username.toLowerCase() && u.email.toLowerCase() === email.toLowerCase());
    if (!user) {
      showMessage("Username and email do not match.");
      return false;
    }
    const newPass = prompt("Enter your new password:");
    if (!newPass || newPass.length < 4) {
      showMessage("Password must be at least 4 characters.");
      return false;
    }
    user.password = newPass;
    saveUsers(users);
    showMessage("Password reset successful. Please login.", false);
    showLogin();
    return true;
  }

  // Event listeners

  // Login form submit
  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = loginUsername.value.trim();
    const password = loginPassword.value;

    if (!username || !password) {
      showMessage("Please enter username and password.");
      return;
    }

    const user = loginUser(username, password);
    if (user) {
      showApp(user);
    } else {
      showMessage("Invalid username or password.");
    }
  });

  // Register form submit
  registerForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = regUsername.value.trim();
    const email = regEmail.value.trim();
    const password = regPassword.value;
    const confirm = regPasswordConfirm.value;

    if (!username || !email || !password || !confirm) {
      showMessage("Please fill all fields.");
      return;
    }
    if (password !== confirm) {
      showMessage("Passwords do not match.");
      return;
    }
    if (password.length < 4) {
      showMessage("Password must be at least 4 characters.");
      return;
    }

    if (registerUser(username, email, password)) {
      registerForm.reset();
      showLogin();
    }
  });

  // Reset form submit
  resetForm.addEventListener('submit', e => {
    e.preventDefault();
    const username = resetUsername.value.trim();
    const email = resetEmail.value.trim();

    if (!username || !email) {
      showMessage("Please enter username and registered email.");
      return;
    }

    resetPassword(username, email);
  });

  // Show register form
  showRegisterBtn.addEventListener('click', () => {
    showRegister();
  });

  // Show reset form
  showResetBtn.addEventListener('click', () => {
    showReset();
  });

  backToLoginFromReg.addEventListener('click', () => {
    showLogin();
  });

  backToLoginFromReset.addEventListener('click', () => {
    showLogin();
  });

  // Logout button
  logoutBtn.addEventListener('click', () => {
    logoutUser();
  });

  // Admin save slots
  saveSlotsBtn.addEventListener('click', () => {
    saveAdminSlots();
  });

  // Search bar filtering
  searchBar.addEventListener('input', () => {
    const query = searchBar.value.trim().toLowerCase();
    const cards = slotsContainer.querySelectorAll('.slot-card');

    cards.forEach(card => {
      const name = card.querySelector('h3').textContent.toLowerCase();
      card.style.display = name.includes(query) ? 'block' : 'none';
    });
  });

  // On page load, check if user is logged in
  window.onload = () => {
    const user = getCurrentUser();
    if (user) {
      showApp(user);
    } else {
      showLogin();
    }
  };
</script>

</body>
</html>
