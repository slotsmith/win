<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi‚ÄëProvider Slot Win Rate Tracker</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    h1 { color: #ffcc00; margin-bottom: 10px; }
    input {
      padding: 10px;
      width: 90%;
      max-width: 400px;
      margin-bottom: 10px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
    }
    button {
      padding: 8px 16px;
      font-size: 14px;
      border: none;
      border-radius: 6px;
      background: #ffcc00;
      color: #111;
      cursor: pointer;
      margin-bottom: 15px;
    }
    button:hover { background: #e6b800; }
    .info { font-size: 12px; color: #aaa; margin-bottom: 20px; }
    .slot-card {
      background: #222;
      margin: 15px auto;
      padding: 15px;
      width: 90%;
      max-width: 500px;
      border: 1px solid #444;
      border-radius: 10px;
      text-align: left;
    }
    .progress-bar {
      height: 14px;
      background: #444;
      border-radius: 7px;
      overflow: hidden;
      margin-top: 5px;
      width: 100%;
    }
    .fill {
      height: 100%;
      background: #00cc66;
      transition: width 1s ease;
    }
    .winrate {
      font-weight: bold;
      margin-bottom: 6px;
    }
    .prediction {
      font-weight: bold;
      margin-bottom: 6px;
      color: #0af;
    }
    .spin-type {
      font-style: italic;
      color: #ffd966;
      margin-top: 6px;
    }
    .advice { margin-top: 10px; font-weight: bold; }
    .good { color: #0f0; }
    .wait { color: #f55; }
    canvas {
      margin-top: 15px;
      background: #111;
      border-radius: 6px;
      width: 100% !important;
      height: 120px !important;
    }
    .updated-time { font-size: 14px; color: #ccc; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>üé∞ Multi‚ÄëProvider Slot Win Rate Tracker</h1>
  <input type="text" id="searchInput" placeholder="Search slots..." />
  <br/>
  <button id="toggleUpdatesBtn">Pause Updates ‚è∏Ô∏è</button>
  <div class="updated-time" id="lastUpdated">Last updated: --:--:--</div>
  <div class="info">‚ÑπÔ∏è Win rates update every 30 seconds. Data is simulated.</div>
  <div id="slotsContainer"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const providers = {
      "Pragmatic Play": [
        "Irish Crown",
        "Gates of Olympus Super Scatter",
        "Mahjong Wins Super Scatter",
        "Wild West Gold Blazing Bounty",
        "Gates of Hades",
        "The Dog House ‚Äì Royal Hunt",
        "Book of Monsters",
        "Big Bass Bonanza 1000",
        "Starlight Princess 1000",
        "Gates of Olympus 1000",
        "Sugar Rush 1000",
        "Sweet Bonanza 1000",
        "Wisdom of Athena 1000",
        "Gates of Olympus Xmas 1000",
        "Hades Inferno 1000",
        "Big Bass Bonanza 1000",
        "Lucky Tiger 1000",
        "Sweet Bonanza",
        "Sugar Rush",
        "Gates of Olympus",
        "Starlight Princess",
        "Big Bass Splash",
        "Fruit Party",
        "Wild West Gold",
        "The Dog House",
        "Power of Thor Megaways",
        "Joker‚Äôs Jewels",
        "Floating Dragon",
        "Madame Destiny Megaways",
        "John Hunter and the Tomb of the Scarab Queen",
        "Chilli Heat",
        "Buffalo King Megaways",
        "Mustang Gold",
        "5 Lions",
        "Aztec Gems",
        "Pyramid Bonanza",
        "Lucky Lightning"
      ]
    };

    const allSlots = providers["Pragmatic Play"];
    const slotHistories = {}, slotSpinHistories = {}, charts = {};
    const spinTypes = ["Buy Spin", "Normal Spin"];
    let isUpdating = true;

    const slotScatterData = {};
    allSlots.forEach(slot => {
      slotHistories[slot] = [];
      slotSpinHistories[slot] = [];
      slotScatterData[slot] = {
        lastBetAmount: 0,
        lastScatterHit: false,
        lastScatterBet: null,
        normalSpinsSinceScatter: 0,
        highestWin: 0,
      };
    });

    function getRandomWinRate() {
      return +(Math.random() * 100).toFixed(2);
    }
    function getRandomSpinType() {
      return spinTypes[Math.floor(Math.random() * spinTypes.length)];
    }
    function didScatterHit(spinType) {
      if (spinType === "Normal Spin") {
        return Math.random() < 0.20;
      }
      return false;
    }
    function getRandomBetAmount() {
      return Math.floor(Math.random() * 6000) + 1;
    }
    function formatTime() {
      return new Date().toLocaleTimeString('en-US',{hour12:false});
    }
    function movingAverage(arr) {
      const n = Math.min(arr.length, 5);
      const sum = arr.slice(0, n).reduce((a, v) => a + v.rate, 0);
      return +(sum / n).toFixed(2);
    }

    // New function: Predict win rate based on recent trend
    function predictWinRate(history) {
      if (history.length < 3) return movingAverage(history);

      const last = history[0].rate;
      const prev = history[1].rate;
      const prev2 = history[2].rate;

      const trend = (last - prev) + (prev - prev2);
      const avg = movingAverage(history);

      const factor = 0.6; // sensitivity factor
      let prediction = avg + trend * factor;

      prediction = Math.min(100, Math.max(0, prediction));

      return prediction;
    }

    function getRecommendedBetAmount(predictedRate, slotName) {
      // Assign max bet amounts based on slot (example values, adjust as needed)
      const maxBetMap = {
        "Irish Crown": 5000,
        "Gates of Olympus Super Scatter": 6000,
        "Mahjong Wins Super Scatter": 4000,
        "Wild West Gold Blazing Bounty": 5500,
        "Gates of Hades": 4500,
        "The Dog House ‚Äì Royal Hunt": 4000,
        "Book of Monsters": 3500,
        "Big Bass Bonanza 1000": 6000,
        "Starlight Princess 1000": 6500,
        "Gates of Olympus 1000": 6000,
        "Sugar Rush 1000": 5800,
        "Sweet Bonanza 1000": 6200,
        "Wisdom of Athena 1000": 5000,
        "Gates of Olympus Xmas 1000": 6000,
        "Hades Inferno 1000": 5700,
        "Lucky Tiger 1000": 5000,
        "Sweet Bonanza": 4000,
        "Sugar Rush": 3500,
        "Gates of Olympus": 5500,
        "Starlight Princess": 6000,
        "Big Bass Splash": 3000,
        "Fruit Party": 3200,
        "Wild West Gold": 5000,
        "The Dog House": 3500,
        "Power of Thor Megaways": 4800,
        "Joker‚Äôs Jewels": 3000,
        "Floating Dragon": 3000,
        "Madame Destiny Megaways": 5200,
        "John Hunter and the Tomb of the Scarab Queen": 4000,
        "Chilli Heat": 3200,
        "Buffalo King Megaways": 5500,
        "Mustang Gold": 4500,
        "5 Lions": 2800,
        "Aztec Gems": 2800,
        "Pyramid Bonanza": 2500,
        "Lucky Lightning": 2300
      };

      const maxBet = maxBetMap[slotName] || 3000;

      // Bet amount is proportional to predicted win rate (from 0 to maxBet)
      return Math.round((predictedRate / 100) * maxBet);
    }

    function destroyCharts() {
      Object.values(charts).forEach(c => c && c.destroy());
      Object.keys(charts).forEach(k => delete charts[k]);
    }

    function renderSlots() {
      const container = document.getElementById("slotsContainer");
      container.innerHTML = "";
      destroyCharts();
      const search = document.getElementById("searchInput").value.toLowerCase();

      allSlots.filter(s => s.toLowerCase().includes(search))
        .forEach(slot => {
          const h = slotHistories[slot];
          if (!h.length) return;

          const avg = movingAverage(h);
          const prediction = predictWinRate(h);
          const predictionStr = prediction.toFixed(2);
          const spin = slotSpinHistories[slot][0];
          const time = h[0].time;
          const advice = avg > 50 ? {cls:"good", txt:"Good time to bet!"}
                                  : {cls:"wait", txt:"Better to wait."};
          const rateColor = avg > 50 ? "#0f0" : "#f55";

          // Determine recommended spin type based on avg win rate
          let recommendedSpin;
          if (avg > 65) {
            recommendedSpin = "Buy Spin";
          } else if (avg >= 40) {
            recommendedSpin = "Normal Spin";
          } else {
            recommendedSpin = "Do Not Spin";
          }

          const recommendedBet = getRecommendedBetAmount(prediction, slot);

          const div = document.createElement("div");
          div.className = "slot-card";
          div.innerHTML = `
            <h2>${slot} (Pragmatic Play)</h2>
            <div class="winrate" style="color:${rateColor}">
              Moving Avg Win Rate: ${avg}% (last: ${h[0].rate}% at ${time})
            </div>
            <div class="prediction">
              Predicted Win Rate (next 30s): ${predictionStr}%
            </div>
            <div>
              <div>Last Spin Type: <b>${spin}</b></div>
              <div class="spin-type">Recommended Spin Type: <b>${recommendedSpin}</b></div>
              <div class="spin-type">Recommended Bet Amount: <b>‚Ç±${recommendedBet}</b></div>
            </div>
            <div class="advice ${advice.cls}">${advice.txt}</div>
            <div class="progress-bar" title="Win rate bar">
              <div class="fill" style="width:${avg}%"></div>
            </div>
            <canvas id="chart_${slot.replace(/\s/g, '')}" aria-label="Win rate chart for ${slot}" role="img"></canvas>
          `;
          container.appendChild(div);

          // Create chart
          const ctx = document.getElementById(`chart_${slot.replace(/\s/g, '')}`).getContext('2d');
          charts[slot] = new Chart(ctx, {
            type: 'line',
            data: {
              labels: h.map(d => d.time).reverse(),
              datasets: [{
                label: 'Win Rate %',
                data: h.map(d => d.rate).reverse(),
                borderColor: '#0f0',
                backgroundColor: 'rgba(0,255,0,0.2)',
                fill: true,
                tension: 0.3,
                pointRadius: 3,
              }]
            },
            options: {
              animation: false,
              scales: {
                y: { min: 0, max: 100, ticks: { stepSize: 10 } },
                x: { display: false }
              },
              plugins: { legend: { display: false } },
              maintainAspectRatio: false,
            }
          });
        });
    }

    function updateData() {
      if (!isUpdating) return;
      const now = formatTime();
      document.getElementById("lastUpdated").textContent = `Last updated: ${now}`;

      allSlots.forEach(slot => {
        const rate = getRandomWinRate();
        const spinType = getRandomSpinType();

        // Update histories (keep last 10 records)
        slotHistories[slot].unshift({rate, time: now});
        if (slotHistories[slot].length > 10) slotHistories[slot].pop();

        slotSpinHistories[slot].unshift(spinType);
        if (slotSpinHistories[slot].length > 1) slotSpinHistories[slot].pop();

        // Update scatter and other data
        const scatterHit = didScatterHit(spinType);
        const scatterData = slotScatterData[slot];
        scatterData.lastBetAmount = getRandomBetAmount();
        scatterData.lastScatterHit = scatterHit;

        if (scatterHit) {
          scatterData.lastScatterBet = scatterData.lastBetAmount;
          scatterData.normalSpinsSinceScatter = 0;
        } else {
          scatterData.normalSpinsSinceScatter++;
        }
        if (rate > scatterData.highestWin) {
          scatterData.highestWin = rate;
        }
      });

      renderSlots();
    }

    document.getElementById("searchInput").addEventListener("input", renderSlots);
    document.getElementById("toggleUpdatesBtn").addEventListener("click", () => {
      isUpdating = !isUpdating;
      document.getElementById("toggleUpdatesBtn").textContent = isUpdating ? "Pause Updates ‚è∏Ô∏è" : "Resume Updates ‚ñ∂Ô∏è";
    });

    // Initial fill of histories with dummy data
    allSlots.forEach(slot => {
      for(let i=0; i<7; i++){
        slotHistories[slot].push({
          rate: +(Math.random()*100).toFixed(2),
          time: formatTime()
        });
      }
      slotSpinHistories[slot].push(getRandomSpinType());
    });

    renderSlots();
    setInterval(updateData, 30000);
  </script>
</body>
</html>
